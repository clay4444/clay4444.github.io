---
title: 关于内部类的那些事
categories:
  - Java基础
abbrlink: 1c38ec28
date: 2017-12-16 12:38:03
---



### 使用场景

只考虑为它的外部类提供服务

#### 1. 成员内部类

无条件的访问外部类的成员 / 方法

创建方式：

~~~java
Outer outer = new Outer()
Outer.Inner inner = outer.new Inner()
~~~

#### 2. 局部内部类

方法 / 作用域 内，仅限作用域访问

#### 3. 静态内部类

不依赖外部类，不能使用外部类非static的 属性/ 方法

<br/>

### 为何内部类无条件访问外部类

内部类是Java的一个语法糖，编译完成之后是两个class文件，匿名内部类编译完后是：外部类名$x。成员内部类编译完之后是：外部类名\$内部类名，编译器会默认为成员内部类添加一个参数类型指向外部类对象的构造方法，此时内部类中就包含了一个外部类的引用，此时就可以无条件访问外部类。

<br/>

### 为何局部内部类和匿名内部类只能访问局部final类型的变量

局部匿名类在源代码编译后也是要生成对应的class文件的（一般会是A\$1.class这种形式的文件），那么这个二进制文件是独立于其外围类（A.class）的，就是说它无法知道A类中方法的变量。但是A$1.class又确实要访问A类对应方法的局部变量的值。。。怎么办呢？

于是干脆就要求“匿名内部类调用的方法内局部变量必须为final”，这样A$1.class访问A类方法局部变量部分就直接用常量来表示

比如我们在一个方法内写了一个Thread匿名内部类，当外部方法执行完毕后，方法内的局部变量声明周期结束，而Thread对象的声明周期还未结束，所以必须用final修饰外部类的局部变量，以使得它在编译阶段就被放到常量池中。

